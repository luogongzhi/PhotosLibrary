{"version":3,"file":"pages/index/index.js","sources":["webpack:///./src/pages/index/index.vue?1497","webpack:///._src_pages_index_index.vue","webpack:///./src/pages/index/index.vue?0e79","webpack:///./src/pages/index/index.vue?e724","webpack:///./src/pages/index/index.vue?5b58","webpack:///./src/pages/index/index.vue?d348","webpack:///./src/pages/index/index.vue?550b"],"sourcesContent":["import { render } from \"./index.vue?vue&type=template&id=1badc801\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=1badc801&lang=scss\"\nscript.render = render\n/* hot reload */\nif (module.hot) {\n  script.__hmrId = \"1badc801\"\n  const api = __VUE_HMR_RUNTIME__\n  module.hot.accept()\n  if (!api.createRecord('1badc801', script)) {\n    api.reload('1badc801', script)\n  }\n  \n  module.hot.accept(\"./index.vue?vue&type=template&id=1badc801\", () => {\n    api.rerender('1badc801', render)\n  })\n\n}\n\nscript.__file = \"src/pages/index/index.vue\"\n\nexport default script","<template>\r\n  <view class=\"index\">\r\n    <nut-toast\r\n      :msg=\"toast.msg\"\r\n      v-model:visible=\"toast.show\"\r\n      :type=\"toast.type\"\r\n      :cover=\"toast.cover\"\r\n    />\r\n    <nut-cell>\r\n      <view class=\"infiniteUl\">\r\n        <nut-infiniteloading\r\n          pull-txt=\"loading\"\r\n          load-more-txt=\"没有啦～\"\r\n          container-id=\"scrollDemo\"\r\n          :is-open-refresh=\"infiniteloading.isOpenRefresh\"\r\n          :has-more=\"infiniteloading.hasMore\"\r\n          @load-more=\"loadMore\"\r\n        >\r\n          <!-- <nut-backtop height=\"2000px\" :distance=\"100\" :bottom=\"90\">\r\n            <template v-slot:content> -->\r\n              <view\r\n                class=\"infiniteLi\"\r\n                v-for=\"(item, index) in pictures\"\r\n                :key=\"item.id\"\r\n              >\r\n                <img\r\n                  :src=\"`https://picsum.photos/id/${item.id}/200`\"\r\n                  class=\"resize\"\r\n                  @tap=\"toDetail(index)\"\r\n                />\r\n                <view>\r\n                  {{ index + \"-\" + item.author }}\r\n                  <nut-icon\r\n                    :name=\"item.is_follow == false ? 'addfollow' : 'heart-fill'\"\r\n                    :key=\"item.id\"\r\n                    class=\"follow\"\r\n                    @tap=\"follow(item, index)\"\r\n                  />\r\n                </view>\r\n              </view>\r\n            <!-- </template>\r\n          </nut-backtop> -->\r\n        </nut-infiniteloading>\r\n      </view>\r\n    </nut-cell>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { toRefs, reactive, onMounted, computed } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport Taro from \"@tarojs/taro\";``\r\nexport default {\r\n  name: \"Index\",\r\n  setup() {\r\n    const store = useStore();\r\n    const state = reactive({\r\n      pictures: computed(() => store.state.pictures),\r\n      page: 1,\r\n      toast: {\r\n        msg: \"toast\",\r\n        type: \"text\",\r\n        show: false,\r\n        cover: false,\r\n      },\r\n      infiniteloading: {\r\n        isOpenRefresh: false,\r\n        hasMore: true,\r\n      },\r\n    });\r\n    const methods = {\r\n      openToast: (type, msg, cover = false) => {\r\n        state.toast.show = true;\r\n        state.toast.msg = msg;\r\n        state.toast.type = type;\r\n        state.toast.cover = cover;\r\n      },\r\n\r\n      loadPage: async (page) => {\r\n        methods.openToast(\"loading\", \"加载中\", true);\r\n        try {\r\n          const res = await store.dispatch(\"LOAD_PICTURE_MUTATIONS\", {\r\n            page: page,\r\n          });\r\n        } catch (error) {\r\n          methods.openToast(\"fail\", \"加载失败\");\r\n          console.log(error.message());\r\n        } finally {\r\n          state.toast.show = false;\r\n        }\r\n      },\r\n\r\n      loadMore: (done) => {\r\n        methods.loadPage(++state.page);\r\n        done();\r\n      },\r\n\r\n      toDetail: (index) => {\r\n        Taro.navigateTo({\r\n          url: `/pages/detail/index?idx=${index}`,\r\n        });\r\n      },\r\n\r\n      follow: (item, index) => {\r\n        item.is_follow == false\r\n          ? methods.addfollow(index)\r\n          : methods.delfollow(item.id, index);\r\n          // console.log(item);\r\n      },\r\n\r\n      addfollow: (index) => {\r\n        store.commit(\"ADD_TO_MYFOLLOW\", index);\r\n        methods.openToast(\"success\", \"已添加至收藏\", false);\r\n      },\r\n\r\n      delfollow: (id, index) => {\r\n        store.commit(\"DEL_MYFOLLOW\", { id: id, index: index });\r\n        methods.openToast(\"success\", \"已取消收藏\", false);\r\n      },\r\n\r\n      init: () => {\r\n        try {\r\n          let pictures = Taro.getStorageSync(\"pictures\");\r\n          let myfollow = Taro.getStorageSync(\"myfollow\");\r\n          if (pictures) {\r\n            store.commit(\"UPDATE_PICTURE\", JSON.parse(pictures));\r\n          } else {\r\n            methods.loadPage(state.page);\r\n          }\r\n          if (myfollow) {\r\n            store.commit(\"UPDATE_MYFOLLOW\", JSON.parse(myfollow));\r\n          }\r\n        } catch (error) {\r\n          methods.openToast(\"fail\", \"同步数据失败\");\r\n          console.log(error);\r\n        } finally {\r\n          state.toast.show = false;\r\n        }\r\n      },\r\n    };\r\n\r\n    onMounted(() => {\r\n      methods.init();\r\n    });\r\n    return {\r\n      ...toRefs(state),\r\n      ...methods,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.index {\r\n  font-family: \"Avenir\", Helvetica, Arial, sans-serif;\r\n  -webkit-font-smoothing: antialiased;\r\n  -moz-osx-font-smoothing: grayscale;\r\n  text-align: center;\r\n}\r\n.infiniteUl {\r\n  height: 550px;\r\n  width: 100%;\r\n  overflow-y: auto;\r\n  overflow-x: hidden;\r\n}\r\n.infiniteLi {\r\n  margin-top: 10px;\r\n  font-size: 14px;\r\n  color: rgba(100, 100, 100, 1);\r\n  text-align: center;\r\n}\r\n.resize {\r\n  max-width: 100%;\r\n  height: 260px;\r\n  width: 95%;\r\n  margin: 10px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 13px 27px -5px hsl(240deg 30% 28% / 25%),\r\n    0 8px 16px -8px hsl(0deg 0% 0% / 30%), 0 -6px 16px -6px hsl(0deg 0% 0% / 3%);\r\n}\r\n\r\n.follow {\r\n  left: 30px;\r\n  top: 7px;\r\n  color: red;\r\n}\r\n</style>\r\n","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/taro-loader/lib/raw.js!./index.vue\"\nvar config = {\"navigationBarTitleText\":\"PHOTOSLIBRARY-首页\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/index/index', {root:{cn:[]}}, config || {}))\n\n","export { default } from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.vue?vue&type=script&lang=js\"; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.vue?vue&type=script&lang=js\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js??ref--1-oneOf-0-1!../../../node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/postcss-loader/dist/cjs.js??ref--1-oneOf-0-2!../../../node_modules/resolve-url-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js??ref--1-oneOf-0-4!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.vue?vue&type=style&index=0&id=1badc801&lang=scss\"","export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/dist/templateLoader.js??ref--6!../../../node_modules/vue-loader/dist/index.js??ref--10-0!./index.vue?vue&type=template&id=1badc801\""],"mappings":";;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAYA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AC0BA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAFA;AATA;AAcA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAIA;AADA;AACA;AAJA;AAGA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AAOA;AACA;AACA;AATA;AAAA;AAUA;AAVA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAcA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApEA;AAuEA;AACA;AACA;AACA;AAIA;AAhGA;;;;;;;;;;;;;;;;;;AAnDA;;;AAQA;;;;;;;;;;;AARA;AAEA;AACA;;AAAA;AAGA;AAFA;AACA;AACA;;AALA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AA0BA;AAxBA;AAAA;AAEA;AACA;AAEA;AAgBA;AAbA;AACA;AACA;AAAA;AAAA;AACA;;AAJA;AAOA;AAMA;AALA;AACA;AACA;AACA;AAAA;AAAA;AACA;;AALA;AAOA;;AAnBA;AAFA;;;;AARA;;AAAA;AADA;;;;AAmCA;;;;;;;;;;;;AC5CA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;;;;;;;;;;;;;;ACAA;AAAA;AAAA;;;;;A","sourceRoot":""}